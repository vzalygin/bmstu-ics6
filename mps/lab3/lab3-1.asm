.include "m8515def.inc"
.def temp = r16

.org $000
rjmp INIT
.org $007
rjmp T0_OVF


INIT: ldi temp,low(RAMEND)
  out SPL,temp
  ldi temp,high(RAMEND)
  out SPH,temp

  clr temp ;?????????????????????????? ?????????????? ?????????? PC
  out DDRC,temp ; ???? ????????
  ldi temp,0x01 ;?????????????????? ?????????????????????????????????? ??????????????????
  out PORTC,temp ; ?????????? PC0
  ser temp ;?????????????????????????? ?????????????? ?????????? PB ?? PD
  out DDRB,temp ; ???? ??????????
  out PORTB,temp
  out DDRD,temp ; ???? ??????????
  out PORTD,temp ;???????????????????? ??????????????????????
  ldi temp,(1<<SE) ;???????????????????? ????????????????
  out MCUCR,temp ; ?? ?????????? Idle
;***?????????????????? ?????????????? ??0 ???? ?????????? ???????????????? ??????????????
  ldi temp,0x02 ;???????????????????? ???????????????????? ????
  out TIMSK,temp ; ???????????????????????? ?????????????? ??0
  ldi temp,0x07 ;???????????????????????? ??????????????
  out TCCR0,temp ; ???? ???????????????????????????? ???????????????? ????????????????????
  sei ;???????????????????? ???????????????????? ????????????????????
  ldi temp,0xFC ;$FC=-4 ??????
  out TCNT0,temp ; ?????????????? 4-?? ??????????????

LOOP: sbic PINC, 0
  rjmp LOOP
;?????????????????????????? ?????????????? ???????????????????? (0/1) ???? PB0
  cbi PORTB,0
  sbi PORTB,0
  rcall DELAY

wait: sbis PINC, 0
  rjmp wait
  rjmp LOOP
;***?????????????????? ???????????????????? ?????? ???????????????????????? ?????????????? T0
T0_OVF: clr temp
  out PORTD,temp ;?????????????????? ??????????????????????
  rcall DELAY ;????????????????
  ser temp
  out PORTD,temp ;???????????????????? ??????????????????????
  ldi temp,0xFC ;????????????????????????
  out TCNT0,temp ; TCNT0
  reti

;*** ???????????????? ***
DELAY: ldi r19,6
ldi r20,255
ldi r21,255
dd: dec r21
  brne dd
  dec r20
  brne dd
  dec r19
  brne dd
  ret
